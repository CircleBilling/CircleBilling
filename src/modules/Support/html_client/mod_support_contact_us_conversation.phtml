{% extends request.ajax ? "layout_blank.phtml" : "layout_default.phtml" %}

{% import "macro_functions.phtml" as mf %}
{% block meta_title %}{{ticket.subject}}{% endblock %}

{% block breadcrumb %}
    <li><a href="{{ 'support/contact-us' | link}}">{% trans 'Contact us' %}</a><span class="divider">/</span></li>
    <li class="active">{{ticket.subject}}</li>
{% endblock %}

{% block content %}
    <div class="row mt-5">
        <div class="col-md-12 text-center">
            <h1>{% trans 'Ticket information' %}</h1>
            <p>{% trans 'Ticket Name: ' %}<i>{{ticket.subject}}</i> | {% trans 'Ticket ID: ' %} <i>{{ ticket.id }}</i></p>
            {% if ticket.status != 'closed' %}
                <button class="btn btn-small api-button" data-api-url="guest/support/ticket_close" data-api-data='{"hash" : "{{ ticket.hash}}" }' data-api-reload="1"> {% trans 'Close ticket' %}</button>
            {% endif %}
        </div>
    </div>


    <div class="row mt-5">
        <div class="col-md-7 col-xs-12">
            <div class="card dark">
                <div class="card-header">
                    {% trans 'Ticket information' %}
                </div>

                <div class="card-body">
                    <ul class="chat">
                        {% for i, message in ticket.messages %}
                        <li class="left clearfix">
                                    <span class="chat-img float-left">
                                        <img src="{{ message.author.email|gravatar }}?size=60" alt="{{ message.author.name }}" class="img-circle" />
                                    </span>

                            <div class="chat-body clearfix">
                                <div class="header">
                                    <strong class="primary-font">{{ message.author.name }} ({{ message.author.email }})</strong>
                                    <small class="float-right text-muted">
                                        <span class="glyphicon glyphicon-time"></span>#{{ i+1 }} | {{ message.created_at|bb_date }}
                                    </small>
                                </div>
                                <p>
                                    {{ message.content|bbmd }}
                                </p>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="card dark mt-5">
                <div class="card-header">
                    {% trans 'Ticket Answer' %}
                </div>

                <div class="card-body">
                    {% if ticket.status != 'closed' %}
                    <form method="post" action="" class="api-form" id="public-ticket-reply" data-api-url="guest/support/ticket_reply" data-api-reload="1">
                        <input type="hidden" name="id" value="{{ ticket.id }}">
                        <input type="hidden" name="hash" value="{{ ticket.hash }}" />

                        <div class="form-group">
                            <label>{% trans 'Your message:' %}</label>
                            <textarea name="message" cols="5" rows="6" class="form-control" required="required" id="ticket-reply-text"></textarea>
                        </div>

                        <button class="btn btn-info btn-large text-right" type="submit" id="submit-support-message" value="{% trans 'Post' %}" onclick="">{% trans 'Send' %}</button>
                    </form>
                    {% elseif ticket.status == 'closed' %}
                    <div class="alert alert-white text-center">{% trans 'Ticket was closed and cannot be reopened.' %}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-5 col-xs-12">
            <div class="card dark">
                <div class="card-header">
                    {% trans 'Ticket information' %}
                </div>

                <div class="card-body">
                    <div class="table-responsive">
                        <table cellpadding="0" cellspacing="0" width="100%" class="table">
                            <tbody>
                                <tr>
                                    <td>{% trans 'Subject' %}</td>
                                    <td><b>{{ticket.subject}}</b></td>
                                </tr>

                                <tr>
                                    <td>{% trans 'Author' %}</td>
                                    <td>{{ticket.author.name}}</td>
                                </tr>

                                <tr>
                                    <td>{% trans 'Email' %}</td>
                                    <td>{{ticket.author.email}}</td>
                                </tr>

                                <tr>
                                    <td>{% trans 'Status' %}</td>
                                    <td><div class="label {% if ticket.status=='open'%}label-success{% elseif ticket.status == 'on_hold'%}label-warning{%endif%}">{{mf.status_name(ticket.status) }}</div></td>
                                </tr>

                                <tr>
                                    <td>{% trans 'Time opened' %}</td>
                                    <td>{{ticket.created_at|bb_date }}</td>
                                </tr>
                            </tbody>

                            {% if ticket.status != 'closed' %}
                            {% endif %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}